## **ゲーム仕様書**

### 1\. 概要

本ドキュメントは、Webブラウザ上で動作するリアルタイム砲撃シミュレーションゲームの仕様を定義するものです。プレイヤーは砲台を操作し、自陣に迫りくる目標を撃破します。弾道には空気抵抗やコリオリ力といった物理要素が組み込まれ、精密な照準とタイミングが求められます。また目標のトラッキングには本格的なレーダー操作（2D表示）が必要です。

- **ゲームタイトル:** Browser Artillery
- **プラットフォーム:** PC Webブラウザ (HTML5, CSS3, JavaScript)
- **ゲームエンジン:** 使用しない

### 2\. ゲームの目的

プレイヤーは、砲台と、独立して動くレーダーが操作できます。これらを操作して目標を捜索、撃破します。目標がプレイヤーの砲台位置まで到達するとゲームオーバーとなります。ステージ内の全ての目標を撃破するとステージクリアです。

### 3\. ゲームフロー

ゲームの基本的な流れは以下の通りです。

```
タイトル画面
    ↓
ステージセレクト画面
    ↓
ゲーム画面 (プレイ)
    ├── ステージクリア → ステージセレクト画面へ
    └── ゲームオーバー → ステージセレクト画面へ
```

---

### 4\. 画面仕様

#### 4.1. タイトル/ステージセレクト画面

- **タイトル画面:** ゲームタイトルと「START」ボタンを配置したシンプルな画面。
- **ステージセレクト画面:** 以下の3つのステージを選択するボタンを配置します。
  - **ステージ1:** 静止目標
  - **ステージ2:** 動目標 (低速)
  - **ステージ3:** 動目標 (高速)
- カラースキーム　CRT表示レーダーを模した、黒字に緑のマップ画面と、艦船のコンソールを模したグレーに白や黒などのボタン配置

#### 4.2. ゲーム画面

画面は大きく3つのペイン（領域）に分割されます。

| 左ペイン (25%)         | 中央ペイン (50%)                 | 右ペイン (25%)                                |
| ---------------------- | -------------------------------- | --------------------------------------------- |
| **コントロールパネル** | **水平レーダー (Top-Down View)** | **垂直レーダー (Side View) & ターゲット情報** |
| (照準・発射操作)       | (レーダー画面)                   | (上下分割)                                    |

\<br\>

**4.2.1. 左ペイン：コントロールパネル**
砲の操作を行うUIを配置します。

- **方位角 (Azimuth) 表示/入力:** 現在の方位角を表示。スライダーで調整可能。
- **仰角 (Elevation) 表示/入力:** 現在の仰角を表示。スライダーで調整可能。
  　\* **方位角 (Azimuth) リード表示:** リード角計算結果の方位角を表示。
- **仰角 (Elevation) リード表示:** リード角計算結果の仰角を表示。
- **装填弾頭表示:** 現在選択されている弾頭の種類と初速を表示 (将来的な拡張用)。
- **発射 (FIRE) ボタン:** 砲弾を発射します。
- **ロックオン解除ボタン:** 現在ロックオンしている目標を解除します。
- **時計:** IGTを表示します

**4.2.2. 中央ペイン：水平レーダー**
真上から見たレーダー表示です。横軸が方位、縦軸が距離となる2D表示です。常にレーダーの中心がマップの中心となり、プレイヤーの操作によりレーダーが左右に方向を変えると表示される物体も移動します

- **自軍砲台:** 常にマップ中心の最下端です。
- **目標:** 敵アイコンで表示
- **レーダー中心線:** 常にマップ中心に表示。目標のロックオンに使用。
- **レーダー距離カーソル:** マウス縦ドラッグで操作可能な横線。目標のロックオンに使用。
- **弾道予測線 (オーバーレイ):** 現在の照準設定（方位角、仰角）で発射した場合の砲弾の着弾予測地点を線で表示。リアルタイムで更新されます。
- **実砲弾軌跡 (オーバーレイ):** 発射ボタンを押した後、実際に飛翔中の砲弾の現在位置を動くシンボル（小さな円や点）で表示。砲弾が着弾または目標に命中するまで追跡表示されます。
- **レーダー方位・仰角表示** 現在のレーダー方向（方位角、仰角）を数値で表示。リアルタイムで更新されます。

**4.2.3. 右ペイン：垂直レーダー & ターゲット情報**

- **上部：垂直マップ**
  - 真横から見たレーダー表示です。横軸が距離、縦軸が仰角となる2D表示です。常にレーダーの方位の縦断面を表示します。プレイヤーの操作によりレーダーが左右に方向を変えると表示される物体も移動します
  - 地面、自軍砲台、目標の高度を視覚的に表示します。
  - 現在の照準設定での弾道予測を放物線でオーバーレイ表示します。
  - 飛翔中の実砲弾の現在位置を動くシンボルで表示します。
- **下部：ターゲット情報**
  - ロックオン中の目標に関する情報を表示します。
  - **ステータス:** 「NO TARGET」「TRACKING」「LOCKED ON」など。
  - **目標種別:** 「静止」「動目標(低速)」など。
  - **距離 (Range):** 自軍砲台からの直線距離。
  - **速度 (Speed):** 目標の対地速度。
  - **高度 (Altitude):** 目標の海抜高度。

---

### 5\. ゲームシステム

#### 5.1. 砲撃シミュレーション

砲弾の運動は、以下の物理法則に基づいて計算されます。ゲーム内にランダム要素はなく、同じ条件で撃てば必ず同じ弾道を描きます。

- **初期条件:** 砲弾の初速、射出方位、射出仰角。
- **考慮する力:**
  1.  **重力:** 常に鉛直下向きに作用します。
  2.  **空気抵抗:** 速度の2乗に比例する抵抗力が、進行方向と逆向きに作用します。
  3.  **コリオリ力:** 地球の自転によって発生する見かけの力。北半球では進行方向に対して右向きに作用します。
- **考慮しない力:**
  - 風の影響
- **境界条件:** 砲弾が地面に衝突したらその時点でシミュレーション計算は終了する

この計算結果（未来の座標群）が、弾道予測線としてレーダー上に描画されます。具体的には、発射後の時間に応じて一定時間ごとに未来座標を計算し、計算した点をレーダー上にシンボル表示することで、点線表示をします。

#### 5.1.1. 実砲弾の飛翔表示

発射ボタンが押されると、実際の砲弾オブジェクトが生成され、リアルタイムで物理シミュレーションが実行されます。

- **砲弾の可視化:** 飛翔中の砲弾は、水平レーダー（中央ペイン）と垂直レーダー（右ペイン上部）の両方に動くシンボルとして表示されます。
- **軌跡の描画:** 砲弾が通った経路は薄い軌跡線として一定時間表示され、弾道を視覚的に確認できます。
- **複数砲弾の同時表示:** 連続発射した場合、複数の砲弾が同時に飛翔している状態も正しく表示されます。
- **終了条件:** 砲弾は以下のいずれかの条件で表示から消去されます：
  - 目標に命中した場合
  - 地面に着弾した場合
  - マップの表示範囲外に出た場合

#### 5.2. 照準とロックオン

プレイヤーは以下の手順で目標をロックオンします。

1.  **水平走査:** 中央の水平レーダー上をマウスでドラッグし、レーダーの水平方向の向きを動かしてレーダー中心線を目標に重ねます。
2.  **距離合わせ:** 目標にレーダー中心線が重なったら、垂直方向にドラッグ（またはマウスホイール）して、レーダー距離カーソルを目標に合わせます。
3.  **ロックオン:** カーソルが完全に一致した状態で右クリックすると、その目標をロックオンします。
    - ロックオンできる目標は同時に1つまでです。
    - ロックオン後、目標が移動してもレーダーは自動で追尾します（垂直方向の追跡も自動）。
    - ロックオン中は、レーダー距離カーソルも自動で動きます
    - 目標を撃破するか、ロックオン解除ボタンを押すとロックは解除されます。

#### 5.3. リード角計算

移動目標をロックオンすると、システムは自動でリード角の計算を開始します。

- **計算方法:** 目標の現在位置、速度ベクトル、および自軍の砲弾が目標に到達するまでの時間（弾道計算から算出）を基に、未来の衝突予測地点と、そのための方位仰角を計算します。
- **表示:** 計算された方位仰角が「推奨照準」としてコントロールパネルにリアルタイムで表示されます。プレイヤーはこの推奨照準と目標の動きを見て、先に砲の照準を動かしておいて、最適なタイミングで発射ボタンを押します。

#### 5.4. 命中判定と撃破

- **命中判定:** 砲弾の3次元座標と、目標の3次元座標（当たり判定用の球体を持つ）の距離が一定値以下になった場合に「命中」と判定します。
- **撃破:** 命中に成功すると、目標は撃破エフェクトと共にマップから消滅し、ロックオンは自動的に解除されます。

#### 5.5. ゲームオーバー

目標が自軍砲台の位置（マップ下端の防衛ライン）に到達した場合、爆撃演出と共にゲームオーバーとなります。

---

### 6\. 技術仕様

- **言語:** HTML5, CSS3, JavaScript (ES6以降を推奨)
- **描画:** HTML5 Canvas 2D API を使用して、全てのゲーム要素（マップ、砲台、目標、UI、エフェクト）を描画します。
- **物理演算:** 上記の運動方程式を解くための数値計算（オイラー法やルンゲ＝クッタ法など）をJavaScriptで実装します。
