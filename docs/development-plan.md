# Browser Artillery 開発計画書

## 1. 開発戦略

### 1.1 ハイブリッドアプローチの採用

本プロジェクトでは **TDD（テスト駆動開発）** と **プロトタイピング** を組み合わせたハイブリッドアプローチを採用します。

#### **TDDで実装する領域**

- **物理・数学計算**: 期待値が明確で検証可能
  - ベクトル演算（Vector2, Vector3）
  - 物理演算（重力、空気抵抗、コリオリ力）
  - 弾道計算（軌跡予測、リード角計算）
  - 衝突判定アルゴリズム
- **ビジネスロジック**: ゲームルール、状態管理
  - ゲーム状態遷移
  - ターゲティングシステムのロジック
  - プロジェクタイル管理システム
- **アルゴリズム**: 確定的な計算処理
  - 数値積分法（RK4）
  - 座標変換
  - ゲームループのタイムステップ制御

#### **プロトタイプ主導で実装する領域**

- **UI/UX**: 視覚的確認と操作感の調整が必要
  - レイアウト設計（3ペイン構成）
  - レーダー表示（水平・垂直）
  - コントロールパネルUI
- **Canvas描画**: ピクセル単位の結果検証は困難
  - 描画システム全般
  - エフェクト表現
  - 視覚フィードバック
- **入力システム**: 操作感の確認が重要
  - マウス操作の応答性
  - ドラッグ操作の調整
  - インタラクションの最適化

### 1.2 技術スタック

- **開発言語**: TypeScript
- **テストフレームワーク**: Vitest
- **ビルドツール**: Vite
- **品質管理**: ESLint + Prettier + Husky
- **描画API**: HTML5 Canvas 2D API

### 1.3 品質管理体制

- **Pre-commit Hook**: Huskyによる自動化
  - ESLint（コード品質チェック）
  - TypeScriptコンパイル（型チェック）
  - Prettier（コードフォーマット）
- **テストカバレッジ**: TDD対象領域は90%以上を目標
- **コミット単位**: 各タスク完了時に細かい粒度でコミット

## 2. 詳細タスクリスト

### **フェーズ1: 基盤構築**

#### T001. プロジェクト初期設定

**手法**: セットアップ  
**内容**:

- TypeScript設定（tsconfig.json）
- Vite設定（vite.config.ts）
- Vitest設定（テスト環境）
- ESLint + Prettier設定
- Husky pre-commit hook設定
- package.json依存関係

**成果物**: 開発環境の完全セットアップ
**推定時間**: 2時間

#### T002. 基本Canvas環境とHTML構造

**手法**: プロトタイプ  
**内容**:

- index.htmlファイル作成
- Canvas要素と基本CSSレイアウト
- 3ペイン構成の骨格
- 基本描画テスト（Hello World）

**成果物**: 基本HTML構造とCanvas描画確認
**推定時間**: 1時間

#### T003. Vector3クラス

**手法**: TDD  
**内容**:

- 3Dベクトル演算（加算、減算、スカラー倍）
- 内積、外積計算
- 正規化、長さ計算
- 等価判定

**テストケース**:

- 基本演算の結果検証
- エッジケース（ゼロベクトル等）の処理

**成果物**: `src/core/math/Vector3.ts` + テスト
**推定時間**: 2時間

#### T004. Vector2クラス

**手法**: TDD  
**内容**:

- 2Dベクトル演算（UI座標計算用）
- 回転、角度計算
- スクリーン座標変換

**成果物**: `src/core/math/Vector2.ts` + テスト
**推定時間**: 1.5時間

#### T005. MathUtilsライブラリ

**手法**: TDD  
**内容**:

- 三角関数ユーティリティ
- 角度変換（度 ⇔ ラジアン）
- 補間関数（lerp、slerp）
- 数値範囲クランプ

**成果物**: `src/core/math/MathUtils.ts` + テスト
**推定時間**: 1.5時間

### **フェーズ2: 物理エンジン**

#### T006. Forcesクラス

**手法**: TDD  
**内容**:

- 重力計算（F = mg）
- 空気抵抗計算（F = 0.5ρCdAv²）
- コリオリ力計算（F = -2m(Ω×v)）

**テストケース**:

- 各力の計算結果が物理法則通り
- 異なる条件での力の組み合わせ

**成果物**: `src/physics/Forces.ts` + テスト
**推定時間**: 3時間

#### T007. PhysicsEngine基本機能

**手法**: TDD  
**内容**:

- 4次ルンゲ=クッタ法（RK4）数値積分
- 砲弾の位置・速度更新
- 力の統合計算

**テストケース**:

- 既知解との比較（自由落下等）
- 積分精度の検証

**成果物**: `src/physics/PhysicsEngine.ts` + テスト
**推定時間**: 4時間

#### T008. CanvasManager基礎機能

**手法**: プロトタイプ  
**内容**:

- Canvas初期化・リサイズ処理
- 座標変換ヘルパー
- 基本描画プリミティブ
- デバッグ用描画機能

**成果物**: `src/rendering/CanvasManager.ts`
**推定時間**: 2時間

#### T009. GameLoop固定タイムステップ

**手法**: TDD  
**内容**:

- 固定60Hz物理ステップ
- 可変描画フレームレート
- タイムアキュムレータ管理

**テストケース**:

- タイムステップの一貫性
- フレームドロップ時の挙動

**成果物**: `src/core/GameLoop.ts` + テスト
**推定時間**: 2時間

### **フェーズ3: ゲームエンティティ**

#### T010. Projectileエンティティ

**手法**: TDD  
**内容**:

- 砲弾の状態管理（位置、速度、生存状態）
- 軌跡履歴の記録
- 境界条件チェック

**テストケース**:

- 状態更新の正確性
- 軌跡記録の一貫性

**成果物**: `src/physics/Projectile.ts` + テスト
**推定時間**: 2時間

#### T011. Targetエンティティ

**手法**: TDD  
**内容**:

- 目標の移動パターン（静止、等速、変速）
- 当たり判定領域管理
- 撃破状態管理

**成果物**: `src/game/entities/Target.ts` + テスト
**推定時間**: 2時間

#### T012. Artilleryエンティティ

**手法**: TDD  
**内容**:

- 砲台の照準管理（方位角、仰角）
- 砲弾発射処理
- 初速計算

**成果物**: `src/game/entities/Artillery.ts` + テスト
**推定時間**: 1.5時間

#### T013. Radarエンティティ

**手法**: TDD  
**内容**:

- レーダー方向管理
- 探知範囲計算
- ターゲット追跡状態管理

**成果物**: `src/game/entities/Radar.ts` + テスト
**推定時間**: 2時間

#### T014. Trajectory弾道計算

**手法**: TDD  
**内容**:

- 予測弾道の算出
- 着弾点予測
- 飛行時間計算

**テストケース**:

- 既知条件での弾道検証
- エッジケースの処理

**成果物**: `src/physics/Trajectory.ts` + テスト
**推定時間**: 3時間

#### T015. ProjectileManager

**手法**: TDD  
**内容**:

- 複数砲弾の同時管理
- アクティブ砲弾リスト
- 自動クリーンアップ

**成果物**: `src/physics/ProjectileManager.ts` + テスト
**推定時間**: 2時間

### **フェーズ4: UI・インタラクション**

#### T016. 3ペインレイアウトプロトタイプ

**手法**: プロトタイプ  
**内容**:

- CSS Grid/Flexboxによるレイアウト
- 左25%（コントロール）、中央50%（水平レーダー）、右25%（垂直レーダー・情報）
- レスポンシブ対応

**成果物**: レイアウトプロトタイプ
**推定時間**: 1.5時間

#### T017. レーダー表示プロトタイプ

**手法**: プロトタイプ  
**内容**:

- 水平レーダー（トップダウンビュー）
- 垂直レーダー（サイドビュー）
- グリッド表示、スケール表示

**成果物**: レーダー描画プロトタイプ
**推定時間**: 3時間

#### T018. 基本マウス入力処理

**手法**: 実装  
**内容**:

- マウスイベントハンドリング
- 座標変換（スクリーン→ゲーム）
- ドラッグ状態管理

**成果物**: `src/input/MouseHandler.ts`
**推定時間**: 2時間

#### T019. コントロールパネルUI

**手法**: プロトタイプ  
**内容**:

- 方位角・仰角スライダー
- リード角表示
- 発射ボタン、ロックオン解除ボタン
- 時計表示

**成果物**: コントロールパネルUI
**推定時間**: 3時間

#### T020. レーダー操作

**手法**: プロトタイプ  
**内容**:

- マウスドラッグによるレーダー方向制御
- 距離カーソルの操作
- リアルタイムフィードバック

**成果物**: レーダー操作システム
**推定時間**: 3時間

### **フェーズ5: ゲームシステム**

#### T021. ターゲティングシステム

**手法**: TDD + プロトタイプ  
**内容**:

- ターゲット探知（TRACKING状態）
- ロックオン処理（LOCKED ON状態）
- 自動追尾機能

**TDD部分**: ロジック
**プロトタイプ部分**: 視覚フィードバック

**成果物**: `src/game/systems/TargetingSystem.ts` + テスト
**推定時間**: 4時間

#### T022. LeadCalculatorリード角計算

**手法**: TDD  
**内容**:

- 移動目標の未来位置予測
- 砲弾到達時間計算
- 推奨照準角算出

**テストケース**:

- 等速移動目標での計算検証
- 複雑な移動パターンでの精度

**成果物**: `src/game/systems/LeadCalculator.ts` + テスト
**推定時間**: 4時間

#### T023. 砲弾・軌跡描画システム

**手法**: プロトタイプ  
**内容**:

- リアルタイム砲弾シンボル描画
- 軌跡線の描画とフェードアウト
- 複数砲弾の同時表示

**成果物**: `src/rendering/renderers/ProjectileRenderer.ts`
**推定時間**: 3時間

#### T024. 衝突判定システム

**手法**: TDD  
**内容**:

- 球体同士の距離判定
- 継続的衝突検出
- 衝突応答処理

**テストケース**:

- 各種衝突シナリオの検証
- 高速移動時の検出精度

**成果物**: 衝突判定システム + テスト
**推定時間**: 3時間

#### T025. エフェクトシステム

**手法**: プロトタイプ  
**内容**:

- 爆発エフェクト
- 撃破フィードバック
- パーティクルシステム基礎

**成果物**: `src/rendering/renderers/EffectRenderer.ts`
**推定時間**: 2時間

### **フェーズ6: ゲーム統合**

#### T026. ステージデータ

**手法**: 実装  
**内容**:

- 3種類のステージ設定
- ターゲット配置データ
- 難易度バランス調整

**成果物**: `src/data/StageData.ts`
**推定時間**: 2時間

#### T027. タイトルシーン

**手法**: プロトタイプ  
**内容**:

- タイトル画面UI
- STARTボタン
- CRTスタイル適用

**成果物**: `src/ui/scenes/TitleScene.ts`
**推定時間**: 2時間

#### T028. ステージセレクトシーン

**手法**: プロトタイプ  
**内容**:

- ステージ選択UI
- 3つのステージボタン
- ステージ情報表示

**成果物**: `src/ui/scenes/StageSelectScene.ts`
**推定時間**: 2時間

#### T029. メインゲームシーン

**手法**: 統合  
**内容**:

- 全システムの統合
- ゲームプレイフロー
- ゲームオーバー・クリア処理

**成果物**: `src/ui/scenes/GameScene.ts`
**推定時間**: 4時間

#### T030. GameManager統合・状態管理

**手法**: TDD + 統合  
**内容**:

- シーン遷移管理
- ゲーム状態の永続化
- スコア管理

**成果物**: `src/game/GameManager.ts` + テスト
**推定時間**: 3時間

### **フェーズ7: 最終調整**

#### T031. UIポリッシュ

**手法**: プロトタイプ  
**内容**:

- CRTモニター風スタイル
- 緑色のレーダー表示
- グレー基調のコントロールパネル
- フォント・色調の統一

**成果物**: 完成度の高いUI
**推定時間**: 3時間

#### T032. パフォーマンス最適化

**手法**: 実装  
**内容**:

- オブジェクトプール実装
- 描画最適化
- メモリリーク対策

**成果物**: パフォーマンス改善
**推定時間**: 3時間

#### T033. 統合テストとバグ修正

**手法**: テスト  
**内容**:

- 全機能の動作確認
- ブラウザ互換性テスト
- バグ修正とリファクタリング

**成果物**: 安定動作版
**推定時間**: 4時間

#### T034. 最終調整とゲームバランス調整

**手法**: 調整  
**内容**:

- ゲームバランスの微調整
- 操作性の最終確認
- ドキュメント整備

**成果物**: リリース版
**推定時間**: 2時間

## 3. 開発スケジュール

**総推定時間**: 82時間
**想定期間**: 3-4週間（週20-25時間想定）

### 週次計画

- **Week 1**: フェーズ1-2（基盤構築・物理エンジン）
- **Week 2**: フェーズ3-4（エンティティ・UI）
- **Week 3**: フェーズ5-6（ゲームシステム・統合）
- **Week 4**: フェーズ7（最終調整・ポリッシュ）

## 4. 品質保証

### 4.1 テスト戦略

- **単体テスト**: TDD対象クラスは90%以上のカバレッジ
- **統合テスト**: 主要なゲームフロー
- **手動テスト**: UI・UXの操作感確認

### 4.2 コード品質管理

- **TypeScript strict mode**: 型安全性の保証
- **ESLint**: コード品質ルールの強制
- **Prettier**: 一貫したコードフォーマット
- **Husky pre-commit**: 自動品質チェック

### 4.3 リスク管理

- **技術リスク**: 物理演算の精度問題 → 段階的な検証と調整
- **スコープリスク**: 機能過多 → MVP優先、段階的拡張
- **品質リスク**: バグ混入 → TDDとテスト自動化で予防

このタスクリストに従って段階的に開発を進め、各フェーズで動作確認を行いながら品質の高い砲撃シミュレーションゲームを構築します。
